// Animace sekc√≠ p≈ôi scrollu
(function(){
  const sections=document.querySelectorAll('main section');
  const observer=new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        e.target.style.transform='translateY(0)';
        e.target.style.opacity=1;
      }
    });
  },{threshold:0.08});
  sections.forEach(s=>{
    s.style.opacity=0;
    s.style.transform='translateY(18px)';
    s.style.transition='opacity .7s ease, transform .7s ease';
    observer.observe(s);
  });
})();

// Horn√≠ slideshow
(function(){
  const slidesEl=document.getElementById('slides');
  const slides=Array.from(slidesEl.children);
  const total=slides.length;
  let i=0,timeout=null;
  const dots=document.getElementById('dots');
  slides.forEach((_,idx)=>{
    const b=document.createElement('button');
    b.className='dot-btn';
    b.onclick=()=>{goTo(idx);reset();};
    dots.appendChild(b);
  });
  const dotBtns=Array.from(dots.children);
  function update(){
    slidesEl.style.transform=`translateX(-${i*100}%)`;
    dotBtns.forEach((b,idx)=>b.classList.toggle('active',idx===i));
  }
  function goTo(idx){i=(idx+total)%total;update();}
  function next(){goTo(i+1);}
  function reset(){clearInterval(timeout);timeout=setInterval(next,4200);}
  document.getElementById('next').onclick=()=>{next();reset();};
  document.getElementById('prev').onclick=()=>{goTo(i-1);reset();};
  update();reset();
})();

// Spodn√≠ 3D slideshow (vozov√Ω park)
(function(){
  const track=document.getElementById('wc-track');
  const prev=document.getElementById('wc-prev');
  const next=document.getElementById('wc-next');
  if(!track)return;
  const items=Array.from(track.children);
  let idx=2;
  function clamp(i){return (i+items.length)%items.length;}
  function render(){
    items.forEach(it=>it.className='wc-item');
    const p2=clamp(idx-2),p1=clamp(idx-1),a=clamp(idx),n1=clamp(idx+1),n2=clamp(idx+2);
    items[p2].classList.add('prev2');
    items[p1].classList.add('prev1');
    items[a].classList.add('active');
    items[n1].classList.add('next1');
    items[n2].classList.add('next2');
  }
  function go(d){idx=clamp(idx+d);render();}
  prev.onclick=()=>go(-1);
  next.onclick=()=>go(1);
  render();
  setInterval(()=>go(1),4000);
})();

// Tmav√Ω re≈æim
(function(){
  const btn=document.getElementById('darkToggle');
  if(!btn)return;
  const saved=localStorage.getItem('deniska-dark');
  if(saved==='1')document.body.classList.add('dark');
  function refresh(){
    const isDark=document.body.classList.contains('dark');
    btn.textContent=isDark?'‚òÄÔ∏è':'üåô';
  }
  refresh();
  btn.onclick=()=>{
    document.body.classList.toggle('dark');
    localStorage.setItem('deniska-dark',document.body.classList.contains('dark')?'1':'0');
    refresh();
  };
})();

// P≈ôep√≠naƒç jazyk≈Ø
(function(){
  const langBtn = document.getElementById('langToggle');
  const supportedLangs = ['cs', 'en']; // m≈Ø≈æe≈° p≈ôidat nap≈ô. 'de', 'fr'
  let current = localStorage.getItem('deniska-lang') || 'cs';

  function switchLang() {
      const nextIndex = (supportedLangs.indexOf(current) + 1) % supportedLangs.length;
    current = supportedLangs[nextIndex];
    localStorage.setItem('deniska-lang', current);
    applyLang();
  }

  function applyLang() {
    if (current === 'en') {
      document.documentElement.lang = 'en';
      langBtn.textContent = 'üá¨üáß';
          translateToEnglish();
    } else {
      document.documentElement.lang = 'cs';
      langBtn.textContent = 'üåê';
          translateToCzech();
    }
  }

  function translateToEnglish() {
    document.querySelector('h1').textContent = 'Deniska Transport ‚Äî Professional Passenger and Transfer Services';
    document.querySelector('h2').textContent = 'Contact & Reservations';
    // üëâ p≈ôidej dal≈°√≠ texty podle pot≈ôeby
  }

  function translateToCzech() {
    document.querySelector('h1').textContent = 'Autodoprava Deniska ‚Äî profesion√°ln√≠ p≈ôeprava osob a transfery';
    document.querySelector('h2').textContent = 'Kontakt & rezervace';
  }

  langBtn.addEventListener('click', switchLang);
  applyLang();
})();

// --- Language Switcher ---
(function () {
  const langBtn = document.getElementById("langToggle");
  if (!langBtn) return;

  // P≈ôekladov√° data
  const translations = {
    en: {
      "Autodoprava Deniska ‚Äî profesion√°ln√≠ p≈ôeprava osob a transfery":
        "Deniska Transport ‚Äî professional passenger transport and transfers",
      "Diskr√©tn√≠ a spolehliv√© slu≈æby p≈ôepravy: transfery na leti≈°tƒõ, osobn√≠ p≈ôepravy mezi mƒõsty, pron√°jem vozidla s ≈ôidiƒçem pro svatby a oslavy nebo p≈ôeprava men≈°√≠ho n√°kladu. Modern√≠ vozov√Ω park a zku≈°en√Ω ≈ôidiƒç ‚Äî komfort, bezpeƒç√≠ a p≈ôesnost.":
        "Discreet and reliable transport services: airport transfers, intercity travel, car rental with driver for weddings and events, or small cargo transport. Modern fleet and experienced driver ‚Äî comfort, safety and precision.",
      "Objednat transfer": "Book transfer",
      "Zobrazit cen√≠k": "View price list",
      "Rychl√° hotline": "Quick hotline",
      "Na≈°e slu≈æby": "Our Services",
      "Komplexn√≠ nab√≠dka p≈ôepravy p≈ôizp≈Øsoben√° va≈°im po≈æadavk≈Øm ‚Äî od jednoduch√Ωch transfer≈Ø po dlouhodob√© pron√°jmy s ≈ôidiƒçem.":
        "Comprehensive transport services tailored to your needs ‚Äî from simple transfers to long-term rentals with driver.",
      "Transfery mezi mƒõsty": "Intercity Transfers",
      "P≈ô√≠m√© spoje bez p≈ôestup≈Ø: pohodl√≠, bezpeƒç√≠ a p≈ôesn√Ω odhad ƒçasu p≈ô√≠jezdu.":
        "Direct routes without transfers: comfort, safety, and accurate arrival times.",
      "Transfery na leti≈°tƒõ": "Airport Transfers",
      "Naƒçasov√°n√≠ dle va≈°eho letu, pomoc s zavazadly a profesion√°ln√≠ chov√°n√≠ ≈ôidiƒçe.":
        "Timed to your flight, assistance with luggage, and professional driver conduct.",
      "Svatebn√≠ a spoleƒçensk√© ud√°losti": "Weddings and Events",
      "Elegantn√≠ vozy s ≈ôidiƒçem pro svatby, oslavy a VIP dopravu.":
        "Elegant vehicles with driver for weddings, celebrations and VIP transport.",
      "Mal√Ω n√°klad": "Small Cargo",
      "Mo≈ænost p≈ôevozu men≈°√≠ho n√°kladu v r√°mci slu≈æeb ‚Äì bezpeƒçnƒõ a diskr√©tnƒõ.":
        "Possibility of transporting small cargo ‚Äì safely and discreetly.",
      "Cen√≠k (orientaƒçn√≠)": "Price List (indicative)",
      "N√≠≈æe uveden√© ceny jsou reprezentativn√≠m p≈ô√≠kladem. Ceny jsou smluvn√≠ a mohou se li≈°it podle konkr√©tn√≠ objedn√°vky. V≈°echny ceny jsou uvedeny bez DPH.":
        "Prices below are representative examples. Prices are contractual and may vary depending on the specific booking. All prices exclude VAT.",
      "Osobn√≠ v≈Øz: ≈†koda Kodiaq (max 4 osoby)":
        "Passenger car: ≈†koda Kodiaq (max 4 persons)",
      "Minivan: Mercedes t≈ô√≠dy V (max 6 osob)":
        "Minivan: Mercedes V-Class (max 6 persons)",
      "Pron√°jem vozidla s ≈ôidiƒçem (svatby, oslavy)":
        "Vehicle rental with driver (weddings, events)",
      "Z√°kladn√≠ sazba": "Base rate",
      "V cenƒõ zahrnuto": "Included",
      "pau≈°√°l 50 km za ka≈ædou zapoƒçatou hodinu":
        "flat 50 km for each started hour",
      "ƒåek√°n√≠": "Waiting time",
      "Ka≈æd√° dal≈°√≠ zapoƒçat√° hodina": "Each additional started hour",
      "Ceny zahrnuj√≠ poplatky za parkov√°n√≠ a p≈ô√≠padn√© vjezdy na leti≈°tƒõ.":
        "Prices include parking and potential airport access fees.",
      "Vozov√Ω park": "Fleet",
      "Peƒçlivƒõ udr≈æovan√© vozy od standardn√≠ch osobn√≠ch a≈æ po minivany pro skupiny. V≈°echny vozy jsou poji≈°tƒõn√© a pravidelnƒõ kontrolovan√©.":
        "Well-maintained vehicles from standard cars to minivans for groups. All vehicles are insured and regularly serviced.",
      "Kontakt & rezervace": "Contact & Reservations",
      "Pro rezervace a cenovou nab√≠dku n√°m zavolejte nebo napi≈°te. Preferujeme p≈ô√≠mou domluvu pro up≈ôesnƒõn√≠ trasy, poƒçtu osob a ƒças≈Ø.":
        "For booking or price quote, call or email us. We prefer direct communication to specify route, number of passengers and times.",
      "Odeslat": "Send",
      "Jm√©no a p≈ô√≠jmen√≠": "Full name",
      "Telefon": "Phone",
      "Zpr√°va / po≈æadavek": "Message / request",
      "Rezervace": "Booking",
      "Cen√≠k": "Price list",
      "Slu≈æby": "Services",
      "Kontakt": "Contact",
      "Brno ‚Äì Bratislava": "Brno ‚Äì Bratislava",
      "Brno ‚Äì V√≠de≈à": "Brno ‚Äì Vienna",
      "Brno ‚Äì Praha": "Brno ‚Äì Prague",
      "Kƒç": "CZK",
    },
  };

  let currentLang = localStorage.getItem("lang") || "cs";
  function translatePage(lang) {
    const dict = translations[lang];
    if (!dict) return;

    // textov√© uzly
    document.querySelectorAll("h1,h2,h3,h4,p,strong,button,a,div,span,label,textarea,input,li").forEach(el => {
      const original = el.textContent.trim();
      if (dict[original]) el.textContent = dict[original];
    });

    // placeholdery
    document.querySelectorAll("input[placeholder],textarea[placeholder]").forEach(el => {
      const ph = el.getAttribute("placeholder");
      if (dict[ph]) el.setAttribute("placeholder", dict[ph]);
    });

    // Zmƒõna mƒõny
    if (lang === "en") {
      document.querySelectorAll('.price-row strong[data-translate^="pricing_price"]').forEach(el => {
        const originalText = el.textContent;
        el.textContent = originalText.replace(/Kƒç/g, "CZK");
      });
    } else if (lang === "cs") {
      document.querySelectorAll('.price-row strong[data-translate^="pricing_price"]').forEach(el => {
        const originalText = el.textContent;
        el.textContent = originalText.replace(/CZK/g, "Kƒç");
      });
    }
  }

  function toggleLang() {
    currentLang = currentLang === "cs" ? "en" : "cs";
    localStorage.setItem("lang", currentLang);
    langBtn.textContent = currentLang === "cs" ? "üåê" : "üá®üáø";
    translatePage(currentLang);
  }
  langBtn.addEventListener("click", toggleLang);
  // Inicializace
  if (currentLang !== "cs") translatePage(currentLang);
})();

/* ==== P≈ôeklad + mƒõna (fin√°ln√≠ stabiln√≠ verze) ==== */
(function(){
  const oldBtn = document.getElementById('langToggle');
  if (!oldBtn) return;

  const btn = oldBtn.cloneNode(true);
  oldBtn.parentNode.replaceChild(btn, oldBtn);

  const LANG_KEY = 'deniska-lang';
  let current = localStorage.getItem(LANG_KEY) || 'cs';
  const html = document.documentElement;

  const dict = {
    en: {
      "Autodoprava Deniska ‚Äî profesion√°ln√≠ p≈ôeprava osob a transfery":"Deniska Transport ‚Äî professional passenger transport and transfers",
      "Diskr√©tn√≠ a spolehliv√© slu≈æby p≈ôepravy: transfery na leti≈°tƒõ, osobn√≠ p≈ôepravy mezi mƒõsty, pron√°jem vozidla s ≈ôidiƒçem pro svatby a oslavy nebo p≈ôeprava men≈°√≠ho n√°kladu. Modern√≠ vozov√Ω park a zku≈°en√Ω ≈ôidiƒç ‚Äî komfort, bezpeƒç√≠ a p≈ôesnost.":"Discreet and reliable transport services: airport transfers, intercity travel, car rental with driver for weddings and events, or small cargo transport. Modern fleet and experienced driver ‚Äî comfort, safety and precision.",
      "Objednat transfer":"Book transfer",
      "Zobrazit cen√≠k":"View price list",
      "Rychl√° hotline":"Quick hotline",
      "Na≈°e slu≈æby":"Our Services",
      "Komplexn√≠ nab√≠dka p≈ôepravy p≈ôizp≈Øsoben√° va≈°im po≈æadavk≈Øm ‚Äî od jednoduch√Ωch transfer≈Ø po dlouhodob√© pron√°jmy s ≈ôidiƒçem.":"Comprehensive transport services tailored to your needs ‚Äî from simple transfers to long-term rentals with driver.",
      "Transfery mezi mƒõsty":"Intercity Transfers",
      "P≈ô√≠m√© spoje bez p≈ôestup≈Ø: pohodl√≠, bezpeƒç√≠ a p≈ôesn√Ω odhad ƒçasu p≈ô√≠jezdu.":"Direct routes without transfers: comfort, safety, and accurate arrival times.",
      "Transfery na leti≈°tƒõ":"Airport Transfers",
      "Naƒçasov√°n√≠ dle va≈°eho letu, pomoc s zavazadly a profesion√°ln√≠ chov√°n√≠ ≈ôidiƒçe.":"Timed to your flight, assistance with luggage, and professional driver conduct.",
      "Svatebn√≠ a spoleƒçensk√© ud√°losti":"Weddings and Events",
      "Elegantn√≠ vozy s ≈ôidiƒçem pro svatby, oslavy a VIP dopravu.":"Elegant vehicles with driver for weddings, celebrations and VIP transport.",
      "Mal√Ω n√°klad":"Small Cargo",
      "Mo≈ænost p≈ôevozu men≈°√≠ho n√°kladu v r√°mci slu≈æeb ‚Äì bezpeƒçnƒõ a diskr√©tnƒõ.":"Possibility of transporting small cargo ‚Äì safely and discreetly.",
      "Cen√≠k (orientaƒçn√≠)":"Price List (indicative)",
      "N√≠≈æe uveden√© ceny jsou reprezentativn√≠m p≈ô√≠kladem. Ceny jsou smluvn√≠ a mohou se li≈°it podle konkr√©tn√≠ objedn√°vky. V≈°echny ceny jsou uvedeny bez DPH.":"Prices below are representative examples. Prices are contractual and may vary depending on the specific booking. All prices exclude VAT.",
      "Osobn√≠ v≈Øz: ≈†koda Kodiaq (max 4 osoby)":"Passenger car: ≈†koda Kodiaq (max 4 persons)",
      "Minivan: Mercedes t≈ô√≠dy V (max 6 osob)":"Minivan: Mercedes V-Class (max 6 persons)",
      "Pron√°jem vozidla s ≈ôidiƒçem (svatby, oslavy)":"Vehicle rental with driver (weddings, events)",
      "Z√°kladn√≠ sazba":"Base rate",
      "V cenƒõ zahrnuto":"Included",
      "pau≈°√°l 50 km za ka≈ædou zapoƒçatou hodinu":"flat 50 km for each started hour",
      "ƒåek√°n√≠":"Waiting time",
      "Ka≈æd√° dal≈°√≠ zapoƒçat√° hodina":"Each additional started hour",
      "Ceny zahrnuj√≠ poplatky za parkov√°n√≠ a p≈ô√≠padn√© vjezdy na leti≈°tƒõ.":"Prices include parking and potential airport access fees.",
      "Vozov√Ω park":"Fleet",
      "Peƒçlivƒõ udr≈æovan√© vozy od standardn√≠ch osobn√≠ch a≈æ po minivany pro skupiny. V≈°echny vozy jsou poji≈°tƒõn√© a pravidelnƒõ kontrolovan√©.":"Well-maintained vehicles from standard cars to minivans for groups. All vehicles are insured and regularly serviced.",
      "Kontakt & rezervace":"Contact & Reservations",
      "Pro rezervace a cenovou nab√≠dku n√°m zavolejte nebo napi≈°te. Preferujeme p≈ô√≠mou domluvu pro up≈ôesnƒõn√≠ trasy, poƒçtu osob a ƒças≈Ø.":"For booking or price quote, call or email us. We prefer direct communication to specify route, number of passengers and times.",
      "Odeslat":"Send",
      "Jm√©no a p≈ô√≠jmen√≠":"Full name",
      "Telefon":"Phone",
      "Zpr√°va / po≈æadavek":"Message / request",
      "Rezervace":"Booking",
      "Cen√≠k":"Price list",
      "Slu≈æby":"Services",
      "Kontakt":"Contact",
      "Brno ‚Äì Bratislava":"Brno ‚Äì Bratislava",
      "Brno ‚Äì V√≠de≈à":"Brno ‚Äì Vienna",
      "Brno ‚Äì Praha":"Brno ‚Äì Prague",
      "¬© Autodoprava Deniska ‚Äî V≈°echna pr√°va vyhrazena":"¬© Deniska Transport ‚Äî All rights reserved",
      "IƒåO: 09235787 ‚Ä¢ DIƒå: CZ7409214065 ‚Ä¢ Ceny jsou smluvn√≠, tento cen√≠k je orientaƒçn√≠.":"Company ID: 09235787 ‚Ä¢ VAT ID: CZ7409214065 ‚Ä¢ Prices are contractual; this pricelist is indicative."
    },
    placeholders: {
      en: {
        "Jm√©no a p≈ô√≠jmen√≠":"Full name",
        "Telefon":"Phone",
        "Email":"Email",
        "Zpr√°va / po≈æadavek":"Message / request"
      }
    },
    currency: { cs:"Kƒç", en:"CZK" }
  };

  function saveOriginals(){
    document.querySelectorAll('h1,h2,h3,h4,p,li,button,a,strong,span,div').forEach(el=>{
      if(el.children && el.children.length>0) return;
      if(!el.dataset.orig) el.dataset.orig = el.textContent;
    });
    document.querySelectorAll('input[placeholder],textarea[placeholder]').forEach(el=>{
      if(!el.dataset.origPh) el.dataset.origPh = el.getAttribute('placeholder')||'';
    });
  }

  function translate(lang){
    const t = dict[lang]||{};
    const ph = (dict.placeholders||{})[lang]||{};
    document.querySelectorAll('h1,h2,h3,h4,p,li,button,a,strong,span,div').forEach(el=>{
      if(el.children && el.children.length>0) return;
      const orig = el.dataset.orig || el.textContent;
      if(lang==='cs'){ el.textContent = el.dataset.orig; }
      else if(t[orig]) el.textContent = t[orig];
    });
    document.querySelectorAll('input[placeholder],textarea[placeholder]').forEach(el=>{
      const orig = el.dataset.origPh || el.getAttribute('placeholder')||'';
      if(lang==='cs') el.setAttribute('placeholder',orig);
      else if(ph[orig]) el.setAttribute('placeholder',ph[orig]);
    });
    replaceCurrency(lang);
  }

  function replaceCurrency(lang){
    const from = lang==='en'?dict.currency.cs:dict.currency.en;
    const to   = lang==='en'?dict.currency.en:dict.currency.cs;
    document.querySelectorAll('p,div,strong,li,span').forEach(el=>{
      if(el.children && el.children.length>0) return;
      el.textContent = el.textContent.replace(new RegExp(`\\b${from}\\b`,'g'), to);
    });
  }

  function apply(lang){
    saveOriginals();
    translate(lang);
    html.lang = lang;
    btn.textContent = (lang==='cs'?'EN':'CZ');
    localStorage.setItem(LANG_KEY, lang);
  }

  btn.addEventListener('click',()=>{
    current = (current==='cs'?'en':'cs');
    apply(current);
  });

  apply(current);
})();

// --- Jednoduch√° v√Ωmƒõna mƒõny Kƒç ‚Üî CZK bez ≈°ah√°n√≠ na formul√°≈ôe/atributy ---
(function () {
  // Nahrad√≠ mƒõnu v textov√Ωch uzlech podle <html lang="...">
  function swapCurrencyByLang() {
    const lang = (document.documentElement.lang || 'cs').toLowerCase();
    const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT);

    // povol√≠me r≈Øzn√© mezery p≈ôed mƒõnou (NBSP, narrow NBSP, obyƒçejn√°)
    const SPACE = "[\\u00A0\\u202F\\s]*";
    const reKc  = new RegExp(SPACE + "Kƒç(?![\\w])", "g");   // ‚Ä¶Kƒç
    const reCzk = new RegExp(SPACE + "CZK(?![\\w])", "g");  // ‚Ä¶CZK

    let node;
    while ((node = walker.nextNode())) {
      // p≈ôeskoƒçit pr√°zdn√©/jen whitespace
      if (!node.nodeValue || !node.nodeValue.trim()) continue;

      // ne≈ôe≈°√≠me text v script/style (TreeWalker je do nich nepust√≠), ani v contenteditable ‚Äî tam ≈°ahat nechceme
      if (node.parentElement && node.parentElement.isContentEditable) continue;

      let t = node.nodeValue;

      if (lang === "en") {
        if (reKc.test(t)) t = t.replace(reKc, " CZK");
      } else {
        if (reCzk.test(t)) t = t.replace(reCzk, " Kƒç");
      }

      // sjednocen√≠ v√≠cen√°sobn√Ωch mezer
      t = t.replace(/[\u00A0\u202F]/g, " ").replace(/\s{2,}/g, " ");

      if (t !== node.nodeValue) node.nodeValue = t;
    }
  }

  // Spustit po naƒçten√≠
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", swapCurrencyByLang);
  } else {
    swapCurrencyByLang();
  }

  // Nav√°zat na tvoje tlaƒç√≠tko p≈ôep√≠naƒçe jazyka (pokud existuje)
  const langBtn = document.getElementById("langToggle");
  if (langBtn) {
    langBtn.addEventListener("click", () => {
      // poƒçk√°me, a≈æ dobƒõhne tv≈Øj p≈ôeklad, pak vymƒõn√≠me mƒõnu
      setTimeout(swapCurrencyByLang, 0);
    });
  }
})();

